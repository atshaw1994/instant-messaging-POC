<div class="container mx-auto p-4">

  <div class="flex items-center mb-4">
    <%= link_to "← Back", chats_path, class: "mr-4 text-blue-600 hover:underline font-semibold" %>
    <h1 class="text-2xl font-bold">
      Chat with <%= (@chat.sender == current_user ? @chat.receiver : @chat.sender).display_name %>
    </h1>
  </div>

  <%# 🌟 SUBSCRIBE TO REAL-TIME UPDATES 🌟 %>
  <%= turbo_stream_from @chat, "messages" %>

  <div id="messages" data-chat-id="<%= @chat.id %>" data-current-user-id="<%= current_user.id %>" class="h-96 overflow-y-auto border p-4 rounded-lg bg-gray-50 mb-4">
    <% @chat.messages.includes(:user).each do |message| %>
      <%= render "messages/message", message: message, current_user_id: current_user.id %>
    <% end %>
  </div>

  <%# Message Submission Form %>
  <%= form_with model: [@chat, @message], html: { data: { controller: "reset-form" } } do |form| %>
    <div class="flex">
      <%= form.text_field :body, placeholder: "Type your message...", class: "flex-grow border p-2 rounded-l-lg" %>
      <%= form.submit "Send", class: "bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-r-lg cursor-pointer" %>
    </div>
  <% end %>

</div>